<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mypatch.www.member.mapper.MemberMapper">
	<update id="updatePwd">
		update joinus_member
		set member_pwd = #{member_pwd}
		where member_id = #{member_id}
	</update>
	<delete id="deleteProfile">
		delete from joinus_profile
		where member_id = #{member_id}
	</delete>
	<insert id="insertProfile">
		insert into joinus_profile
		values(#{profile_uuid}, #{member_id}, #{profile_fileName})
	</insert>
	<update id="updateMember">
		update joinus_member
		set member_name = #{member_name},
			member_nick = #{member_nick},
			member_alarm = #{member_alarm}
		where member_id = #{member_id}
	</update>
	<select id="selectMe" resultMap="memberMap">
		select member.member_id, 
			   member.member_pwd, 
			   member.member_name, 
			   member.member_nick,
			   member.member_alarm,
			   pro.profile_uuid, 
			   pro.profile_filename
		from joinus_member member
		left outer join joinus_profile pro
		on member.member_id = pro.member_id
		where member.member_id = #{member_id}
	</select>
	<insert id="insertMemberAuth">
		insert into JOINUS_AUTH
		VALUES(#{member_id},'ROLE_MEMBER')
	</insert>
	<insert id="insertMember">
		insert into JOINUS_MEMBER
		VALUES(#{member_id},#{member_name},#{member_pwd},'N',#{member_nick},sysdate)
	</insert>
	<select id="chkNick" resultType="string">
		select member_nick
		from joinus_member
		where member_nick = #{member_nick}
	</select>
	<select id="chkEmail" resultType="string">
		select member_id
		from joinus_member
		where member_id = #{member_id}
	</select>
	<resultMap type="com.mypatch.www.member.domain.ProfileDTO" id="profileMap">
		<id property="profile_uuid" column="profile_uuid"/>
		<result property="profile_fileName" column="profile_fileName"/>
	</resultMap>
	<resultMap type="com.mypatch.www.member.domain.MemberDTO" id="memberMap">
		<id property="member_id" column="member_id"/>
		<result property="member_pwd" column="member_pwd"/>
		<result property="member_name" column="member_name"/>
		<result property="member_nick" column="member_nick"/>
		<result property="member_alarm" column="member_alarm"/>
		<collection property="authList" resultMap="authMap"></collection>
		<collection property="profileDTO" resultMap="profileMap"></collection>
	</resultMap>
	<resultMap type="com.mypatch.www.member.domain.AuthDTO" id="authMap">
		<result property="member_id" column="member_id"/>
		<result property="auth_rank" column="auth_rank"/>
	</resultMap>
	<select id="selectUser" resultMap="memberMap">
		select member.member_id, 
			   member.member_pwd, 
			   member.member_name, 
			   auth.member_id, 
			   auth.auth_rank
		from joinus_member member
		left outer join joinus_auth auth
		on member.member_id = auth.member_id
		where member.member_id = #{member_id}
	</select>
</mapper>